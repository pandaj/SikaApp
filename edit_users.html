<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="format-detection" content="telephone=no" />
	<meta name="msapplication-tap-highlight" content="no" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
	
	<link rel='shortcut icon' type="image/x-icon" href="img/favicon.ico" />
	<link rel="shortcut icon" type="image/png" href="img/favicon.png" />
	<title>Administrador SIKA</title>

	<link href="library/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="library/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">

	<script src="cordova.js"></script>
	<script src="library/jquery/jquery-1.10.2.js"></script>
	<script src="js/main.js"></script>
	<script>
		loginRedirige('index', 7);
	</script>
</head>
<body class="app header-fixed sidebar-fixed aside-menu-fixed aside-menu-hidden">

	<!-- Header -->
	<header id="header" class="app-header navbar">
		<script> loadHeader(); </script>
	</header>
	<!-- FIN Header -->

	<!-- Contenido -->
	<div class="app-body">

		<!-- Menu Lateral -->
		<div id="side-menu" class="sidebar">
			<script> loadMenu(); </script>
		</div>
		<!-- FIN Menu Lateral -->

		<!-- Main content -->
		<main class="main">

			<!-- Breadcrumb -->
			<ol class="breadcrumb">
				<li class="breadcrumb-item">Home</li>
				<li class="breadcrumb-item">Administración</li>
				<li class="breadcrumb-item active">Admin. Usuarios</li>
			</ol>

			<!-- Contenedor -->
			<div class="container-fluid">
				<div class="animated fadeIn">
					<div class="row">
						<div class="col-md-12">

							<!--- Box Usuarios -->
							<div class="card" id="users-cont">
								<!-- Cont Users -->
							</div>
							<!--- Box Usuarios -->

						</div>
						<!--/.col-->
					</div>
					<!--/.row-->
				</div>

			</div>
			<!-- /.conainer-fluid -->
		</main>

	</div>

	<!-- Footer -->
	<footer class="app-footer">
		<span>Powered by <a href="http://redon.cl" target="_blank">Redon©</a> 2018.</span>
	</footer>
	<script src="library/popper/popper.min.js"></script>
	<script src="library/bootstrap/bootstrap.min.js"></script>
	<script src="js/app.js"></script>
	<!-- FIN Footer -->

	<script>
		function cargaDatos(desde, hasta) {
			if (window.elUsuario) {
				// Si no hay conexion a internet
				if (window.internet) {
					$.ajax({
						url	 : window.dataURL + desde +'.php',
						type : 'GET',
						data : {
							usuario : window.elUsuario.email,
							password: window.elUsuario.pass
						}
					}).done(function(txt) {
						if (txt.substr(0,5) != 'Error') {
							window.localStorage.setItem("pag_"+ desde, txt);
							$(hasta).html(txt);
						} else {
							alert(txt);
						}
					});
				} else {
					var datosCargados = JSON.parse( window.localStorage.getItem("pag_"+ desde) );
					if (datosCargados) {
						$(hasta).html(txt);
					} else {
						alert('No hay datos guardados. Por favor, conectate a internet.');
					}
				}
			}
		}
		var activaTodo = true;
		function borrarUsuario(id) {
			if (activaTodo) {
				if (window.elUsuario) {
					if (window.internet) {
						var confirma = confirm("¿ Estás seguro de querer eliminar para siempre a "+ $('#nombre-'+ id).html() +" ?");
						if (confirma == true) {
							activaTodo = false;
							$.ajax({
								url : window.dataURL +'adminQuerys.php',
								type: 'POST',
								data: {
									usuario : window.elUsuario.email,
									password: window.elUsuario.pass
									dato	: id
								}
							}).done(function(txt) {
								if (txt == 'Exito') {
									$('.card .alert').removeClass('alert-danger');
									$('.card .alert').addClass('alert-success');
									$('.card .alert strong').html('Usuario eliminado correctamente.');
									$('.card .alert').fadeIn(300);
									setTimeout(function() {
										$('.card .alert').fadeOut(300);
									}, 2300);
									setTimeout(function() {
										cargaDatos('edit_users', '#users-cont');
									}, 2600);
								} else {
									activaTodo = true;
									$('.card .alert strong').html(txt);
									$('.card .alert').fadeIn(300);
								}
							});
						}
					} else {
						alert('Debes estar conectado para realizar cambios.');
					}
				}
			}
		}
		function nuevoUsuario() {
			if (window.elUsuario) {
				if (window.internet) {
					location.href = 'edit_user_crear.html';
				}
			}
		}
		function editaUsuario(id) {
			if (window.elUsuario) {
				if (window.internet) {
					location.href = 'edit_user_editar.html?id='+ id;
				}
			}
		}
		cargaDatos('edit_users', '#users-cont');
	</script>

</body>
</html>